# Blog Search API - Refactoring & AI Filter Enhancement

## ๐ ููุฎุต ุงูุชุญุฏูุซุงุช

ุชู ุชูุณูู ููู `route.ts` ุงููุจูุฑ (924 ุณุทุฑ) ุฅูู ูุญุฏุงุช ุฃุตุบุฑ ูููุธูุฉุ ูุน ุฅุถุงูุฉ ูููู AI ุฌุฏูุฏ ูููุชุฑุฉ ูุชุงุฆุฌ ุงูุจุญุซ.

## ๐๏ธ ุงููููู ุงูุฌุฏูุฏ

### 1. **search-types.ts** - ุชุนุฑููุงุช ุงูุฃููุงุน
```typescript
- SearchRequest
- UnifiedSearchResult
- ExaApiResponse
- NewsApiResponse
- AISearchPlan
- AITopicSelection
- AIFilterStats (ุฌุฏูุฏ)
```

### 2. **search-constants.ts** - ุงูุซูุงุจุช ูุงูุจูุงูุงุช ุงูุซุงุจุชุฉ
```typescript
- EXCLUDED_DOMAINS
- getDynamicQueries()
- getFallbackResults()
```

### 3. **search-providers.ts** - ูููุฑู ุงูุจุญุซ ุงูุฎุงุฑุฌููู
```typescript
- searchWithNewsApi()
- searchWithExa()
```

### 4. **search-utils.ts** - ุงูุฏูุงู ุงููุณุงุนุฏุฉ
```typescript
- calculateRecencyScore()
- calculateTitleSimilarity()
- deduplicateResults()
- rankResults()
- extractTextFromHtml()
- fetchFullContent()
- enrichResultsWithContent()
```

### 5. **search-ai-agent.ts** - ูููู ุงูุฐูุงุก ุงูุงุตุทูุงุนู
```typescript
- generateSearchQueries()      // ุชูููุฏ ุงุณุชุนูุงูุงุช ุงูุจุญุซ
- filterSearchResults() โญ NEW  // ููุชุฑุฉ ุงููุชุงุฆุฌ
- selectBestTopic()             // ุงุฎุชูุงุฑ ุฃูุถู ููุถูุน
```

### 6. **route.ts** - ููุทุฉ ุงูููุงูุฉ ุงูุฑุฆูุณูุฉ
- ุชูุณูู ุงูุนูููุงุช
- ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
- ูุนุงูุฌุฉ ุงูุทูุจุงุช ูุงูุงุณุชุฌุงุจุงุช

## โญ ุงูููุฒุฉ ุงูุฌุฏูุฏุฉ: AI Filter Agent

### ุงููุธููุฉ
ูููู ุฐูุงุก ุงุตุทูุงุนู ูููู ุจููุชุฑุฉ ูุชุงุฆุฌ ุงูุจุญุซ ูุจู ุงูุงุฎุชูุงุฑ ุงูููุงุฆูุ ูุฑูุถ:

#### โ ุงูููุงุถูุน ุงููุฑููุถุฉ:
1. **ููุงุถูุน ุบูุฑ ูุชุนููุฉ ุจุงูุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉ:**
   - ุงูุณูุงุณุฉุ ุงูุฑูุงุถุฉุ ุงูุชุฑูููุ ุงููุดุงููุฑ
   - ุงูุฌุฑููุฉุ ุงููุฎุฏุฑุงุชุ ุงูุฃูุดุทุฉ ุบูุฑ ุงููุงููููุฉ
   - ุงูุทูุฑุงูุ ุงูุณูุฑุ ุงูุทูุณ
   - ุงูุจุฑุงูุฌ ุงูุชููุฒููููุฉุ ุงูุฃููุงูุ ุงูููุณููู

2. **ุงูููุงุถูุน ุงูููุฑุฑุฉ:**
   - ููุงุถูุน ูุดุงุจูุฉ ููููุงูุงุช ุงูููุฌูุฏุฉ (>30% ุชุดุงุจู)
   - ูุญุชูู ูุชูุฑุฑ ุจุตูุงุบุฉ ูุฎุชููุฉ
   - ุงุณุชุฑุงุชูุฌูุงุช/ุฃุฏูุงุช ุชู ุชุบุทูุชูุง ูุณุจูุงู

#### โ ุงูููุงุถูุน ุงูููุจููุฉ ููุท:
- ุงุณุชุฑุงุชูุฌูุงุช ููุตุงุฆุญ ุงูุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉ
- ุฃุฏูุงุช ูููุตุงุช ุงูุจูุน ุนุจุฑ ุงูุฅูุชุฑูุช
- ุงูุชุณููู ุงูุฑููู ูููุชุงุฌุฑ ุงูุฅููุชุฑูููุฉ
- ุงูููุฌุณุชูุงุช ูุงูุดุญู
- ูุตุต ุงููุฌุงุญ ูุฏุฑุงุณุงุช ุงูุญุงูุฉ
- ุงุชุฌุงูุงุช ูุงุจุชูุงุฑุงุช ุงูุตูุงุนุฉ

### ุณูุฑ ุงูุนูู ุงูุฌุฏูุฏ

```
STEP 0: ุฌูุจ ุงูููุงูุงุช ุงูููุฌูุฏุฉ
   โ
STEP 1: ุชูููุฏ ุงุณุชุนูุงูุงุช ุจุญุซ ุฐููุฉ (AI)
   โ
STEP 2: ุชูููุฐ ุงูุจุญุซ (NewsAPI + Exa)
   โ
STEP 2.5: ููุชุฑุฉ ุงููุชุงุฆุฌ (AI Filter) โญ NEW
   โ
STEP 3: ุงุฎุชูุงุฑ ุฃูุถู ููุถูุน (AI)
   โ
STEP 4: ุฌูุจ ุงููุญุชูู ุงููุงูู
```

### ูุซุงู ุนูู ุงูุงุณุชุฌุงุจุฉ

```json
{
  "success": true,
  "data": {
    "results": [...],
    "aiAgentUsed": true,
    "aiAnalysis": {
      "searchPlan": {
        "queries": ["..."],
        "reasoning": "..."
      },
      "filterStats": {
        "totalResults": 25,
        "filteredResults": 12,
        "rejectedResults": 13,
        "filteringEnabled": true
      },
      "topicSelection": {
        "title": "...",
        "relevanceScore": 85,
        "uniqueAngle": "..."
      }
    },
    "message": "AI selected: \"...\" (85% relevant, filtered 13 irrelevant results)"
  }
}
```

## ๐ ุงูููุงุฆุฏ

### 1. **ุชูุธูู ุฃูุถู**
- ูู ูุญุฏุฉ ููุง ูุณุคูููุฉ ูุงุญุฏุฉ
- ุณูููุฉ ุงูุตูุงูุฉ ูุงูุชุทููุฑ
- ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงูููุฏ

### 2. **ุฌูุฏุฉ ูุชุงุฆุฌ ุฃุนูู**
- ููุชุฑุฉ ุฐููุฉ ููููุงุถูุน ุบูุฑ ุฐุงุช ุงูุตูุฉ
- ุชุฌูุจ ุงููุญุชูู ุงูููุฑุฑ
- ูุชุงุฆุฌ ุฃูุซุฑ ุตูุฉ ุจุงูุชุฌุงุฑุฉ ุงูุฅููุชุฑูููุฉ

### 3. **ุดูุงููุฉ ุฃูุจุฑ**
- ุฅุญุตุงุฆูุงุช ุงูููุชุฑุฉ ูู ุงูุงุณุชุฌุงุจุฉ
- ุณุฌูุงุช ูุงุถุญุฉ ููู ุฎุทูุฉ
- ุณูููุฉ ุชุชุจุน ุงููุฑุงุฑุงุช

### 4. **ุฃุฏุงุก ูุญุณูู**
- ูุนุงูุฌุฉ ุฃุณุฑุน ูููุชุงุฆุฌ ุฐุงุช ุงูุตูุฉ ููุท
- ุชูููู ุงูููุช ุงููุณุชุบุฑู ูู ุงูุงุฎุชูุงุฑ
- ุงุณุชููุงู ุฃูู ููููุงุฑุฏ

## ๐ง ุงูุงุณุชุฎุฏุงู

### ุชูุนูู ุงูููุชุฑุฉ (ุงูุชุฑุงุถู)
```typescript
POST /api/blog/search
{
  "category": "marketing",
  "useAIFilter": true  // ุงูุชุฑุงุถู
}
```

### ุชุนุทูู ุงูููุชุฑุฉ
```typescript
POST /api/blog/search
{
  "category": "marketing",
  "useAIFilter": false
}
```

## ๐ ููุงุญุธุงุช ุงูุชุทููุฑ

### ุฅุถุงูุฉ ูุนุงููุฑ ููุชุฑุฉ ุฌุฏูุฏุฉ
ุนุฏูู ุฏุงูุฉ `filterSearchResults()` ูู `search-ai-agent.ts`:

```typescript
const systemPrompt = `...
3. โ ูุนูุงุฑ ุฌุฏูุฏ:
   - ูุตู ุงููุนูุงุฑ
   - ุฃูุซูุฉ
...`;
```

### ุชุนุฏูู ุนุชุจุฉ ุงููุจูู
ุบููุฑ ูููุฉ `relevanceScore` ูู `filterSearchResults()`:

```typescript
.filter((r: FilteredResult) => r.isRelevant && r.relevanceScore >= 60)
//                                                                  โ
//                                                          ุนุชุจุฉ ุงููุจูู
```

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ ุงูููุชุฑุฉ
```bash
# ูุน ุงูููุชุฑุฉ
curl -X POST http://localhost:3000/api/blog/search \
  -H "Content-Type: application/json" \
  -d '{"category": "marketing", "useAIFilter": true}'

# ุจุฏูู ุงูููุชุฑุฉ
curl -X POST http://localhost:3000/api/blog/search \
  -H "Content-Type: application/json" \
  -d '{"category": "marketing", "useAIFilter": false}'
```

### ูุฑุงูุจุฉ ุงูุณุฌูุงุช
```
[AI Filter] Step 2.5: Filtering 25 results for relevance...
[AI Filter] โ Filtered 25 results: 12 relevant, 13 rejected
[AI Filter] โ Kept 12/25 results (rejected 13)
```

## ๐ ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ

1. **Cache ููููุชุฑุฉ**: ุญูุธ ูุชุงุฆุฌ ุงูููุชุฑุฉ ูุชุณุฑูุน ุงูุทูุจุงุช ุงููุชูุฑุฑุฉ
2. **ุชุนูู ูู ุงูุชุบุฐูุฉ ุงูุฑุงุฌุนุฉ**: ุชุญุณูู ูุนุงููุฑ ุงูููุชุฑุฉ ุจูุงุกู ุนูู ุงุฎุชูุงุฑุงุช ุงููุณุชุฎุฏู
3. **ููุชุฑุฉ ูุชุนุฏุฏุฉ ุงููุฑุงุญู**: ููุชุฑุฉ ุฃูููุฉ ุณุฑูุนุฉ ุซู ููุชุฑุฉ ุนูููุฉ
4. **ุชูุงุฑูุฑ ุงูููุชุฑุฉ**: ุฅุญุตุงุฆูุงุช ููุตูุฉ ุนู ุฃุณุจุงุจ ุงูุฑูุถ

## ๐ ุงููููุงุช ุงููุชุฃุซุฑุฉ

```
micro-tools/src/
โโโ app/api/blog/search/
โ   โโโ route.ts                    โ ูุญุฏูุซ (ูุจุณุท)
โโโ lib/blog/
    โโโ search-types.ts             โ ุฌุฏูุฏ
    โโโ search-constants.ts         โ ุฌุฏูุฏ
    โโโ search-providers.ts         โ ุฌุฏูุฏ
    โโโ search-utils.ts             โ ุฌุฏูุฏ
    โโโ search-ai-agent.ts          โ ุฌุฏูุฏ + ููุชุฑุฉ
```

## โ ุงูุฎูุงุตุฉ

ุชู ุจูุฌุงุญ:
- โ ุชูุณูู ููู ูุจูุฑ (924 ุณุทุฑ) ุฅูู 6 ูุญุฏุงุช ููุธูุฉ
- โ ุฅุถุงูุฉ ูููู AI ููููุชุฑุฉ ุงูุฐููุฉ
- โ ุชุญุณูู ุฌูุฏุฉ ุงููุชุงุฆุฌ ูุชุฌูุจ ุงููุญุชูู ุงูููุฑุฑ
- โ ุชูููุฑ ุฅุญุตุงุฆูุงุช ุดูุงูุฉ ุนู ุนูููุฉ ุงูููุชุฑุฉ
- โ ุงูุญูุงุธ ุนูู ุงูุชูุงูู ุงููุงูู ูุน ุงูููุฏ ุงูููุฌูุฏ
